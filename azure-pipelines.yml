variables:
  buildConfiguration: 'Debug'

jobs:
- job: BuildAndRunTests
  displayName: Build with code analysis and run tests
  pool:
    vmImage: vs2017-win2016
  steps:
  - task: NuGetCommand@2
    displayName: Restore NuGet packages
  - task: VSBuild@1
    displayName: Build solution
    inputs:
      msbuildArgs: '/p:RunCodeAnalysis=true /warnaserror'
      configuration: $(buildConfiguration)
  - task: VSTest@2
    displayName: Run tests
    inputs:
      testAssemblyVer2: |
       **\*Tests.dll
       !**\obj\**